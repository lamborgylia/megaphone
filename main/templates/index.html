{% extends "base.html" %}
{% load static %}

{% block title %}МегаФон{% endblock %}

{% block content %}
    <!-- Spacer to ensure content is below header -->
    <div style="height: 150px;"></div>

    <!-- МОДАЛЬНОЕ ОКНО ВЫБОРА ГОРОДА -->
    <div class="city-modal hidden" id="cityModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Выберите ваш город</h2>
                <span class="close-btn" onclick="closeCityModal()">&times;</span>
            </div>

            <div class="modal-search">
                <input type="text" placeholder="Или введите его название" id="citySearch">
                <button type="button" class="search-icon" onclick="searchCities()">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <circle cx="11" cy="11" r="8"></circle>
                        <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
                    </svg>
                </button>
            </div>

            <div class="modal-body">
                <div class="regions-list" id="regionsList">
                    <!-- Регионы будут подгружены через AJAX -->
                    <div class="region-placeholder">Загрузка регионов...</div>
                </div>

                <div class="cities-list" id="citiesColumn">
                    <div class="city-placeholder">Выберите область слева или воспользуйтесь поиском</div>
                </div>
            </div>
        </div>
    </div>

    <script>
    // Функция для поиска городов
    function searchCities() {
        const searchInput = document.getElementById('citySearch');
        const query = searchInput.value.trim().toLowerCase(); // Приводим запрос к нижнему регистру
        const citiesColumn = document.getElementById('citiesColumn');
        
        console.log('Searching for:', query);
        
        if (query.length < 2) {
            citiesColumn.innerHTML = '<div class="city-placeholder">Введите минимум 2 символа</div>';
            return;
        }
        
        // Показываем индикатор загрузки
        citiesColumn.innerHTML = '<div class="city-placeholder">Поиск...</div>';
        
        fetch(`/api/search-cities/?query=${encodeURIComponent(query)}`)
            .then(response => {
                console.log('Response status:', response.status);
                return response.json();
            })
            .then(data => {
                console.log('Search results:', data);
                
                if (!data.cities || data.cities.length === 0) {
                    citiesColumn.innerHTML = '<div class="city-placeholder">Города не найдены</div>';
                    return;
                }
                
                // Группируем города по регионам
                const citiesByRegion = {};
                data.cities.forEach(city => {
                    if (!citiesByRegion[city.region_name]) {
                        citiesByRegion[city.region_name] = [];
                    }
                    citiesByRegion[city.region_name].push(city);
                });
                
                // Формируем HTML
                let html = '';
                for (const [regionName, cities] of Object.entries(citiesByRegion)) {
                    html += `<div class="region-group">
                        <div class="region-name">${regionName}</div>
                        ${cities.map(city => `
                            <div class="city-item" 
                                data-region-id="${city.region_id}" 
                                data-town-id="${city.id}"
                                data-region-name="${regionName}"
                                onclick="updateSelectedCity('${city.name}', ${city.region_id}, ${city.id})">
                                ${city.name}
                            </div>
                        `).join('')}
                    </div>`;
                }
                citiesColumn.innerHTML = html;
            })
            .catch(error => {
                console.error('Error searching cities:', error);
                citiesColumn.innerHTML = '<div class="city-placeholder">Ошибка при поиске городов</div>';
            });
    }

    // Добавляем обработчики событий при загрузке страницы
    document.addEventListener('DOMContentLoaded', function() {
        const searchInput = document.getElementById('citySearch');
        let searchTimeout;

        // Обработка ввода в поле поиска
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            searchTimeout = setTimeout(searchCities, 300); // Задержка для избежания частых запросов
        });

        // Обработка нажатия Enter
        searchInput.addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                searchCities();
            }
        });

        // Обработка клика по кнопке поиска
        document.querySelector('.search-icon').addEventListener('click', function(e) {
            e.preventDefault();
            searchCities();
        });
    });

    // Функция для закрытия модального окна
    function closeCityModal() {
        document.getElementById('cityModal').classList.add('hidden');
    }

    // Функция для обновления выбранного города
    function updateSelectedCity(cityName, regionId, townId) {
        console.log('Updating city:', { cityName, regionId, townId }); // Debug log
        
        // Обновляем отображение выбранного города
        document.getElementById('cityHeader').textContent = cityName;
        document.getElementById('cityTariff').textContent = cityName;
        
        // Сохраняем выбор в localStorage
        localStorage.setItem('selectedCity', cityName);
        localStorage.setItem('selectedRegionId', regionId);
        if (townId) {
            localStorage.setItem('selectedTownId', townId);
        } else {
            localStorage.removeItem('selectedTownId');
        }
        
        // Загружаем тарифы для выбранного города
        updateTariffs(regionId, townId);
        
        // Закрываем модальное окно
        closeCityModal();
    }
    </script>

    <!-- КАРУСЕЛЬ Bootstrap -->
    <div id="megafonCarousel" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-inner">
    
        <!-- Слайд 1 -->
        <div class="carousel-item active">
            <div class="carousel-content">
            <div class="left">
                <h2>Активируй МегаСилы</h2>
                <p>Безлимиты, бонусные ГБ и другие опции</p>
                <a href="#" class="btn-custom">Подробнее</a>
            </div>
            <div class="right">
                <img src="../static/img/Frame 1.png" class="floating-img" alt="Активируй МегаСилы" />
            </div>
            </div>
        </div>
    
        <!-- Слайд 2 -->
        <div class="carousel-item">
            <div class="carousel-content">
            <div class="left">
                <h2>Интернет для дома</h2>
                <p>Стабильный, быстрый, доступный — подключай прямо сейчас</p>
                <a href="#" class="btn-custom">Выбрать тариф</a>
            </div>
            <div class="right">
                <img src="../static/img/forhome.png" class="floating-img" alt="Интернет для дома" />
            </div>
            </div>
        </div>
    
        <!-- Слайд 3 -->
        <div class="carousel-item">
            <div class="carousel-content">
            <div class="left">
                <h2>Мобильный<br>оператор №1</h2>
                <p>По скорости и покрытию</p>
                <a href="#" class="btn-custom">Подробнее</a>
            </div>
            <div class="right">
                <img src="../static/img/banner3.png" class="floating-img" alt="Мобильный оператор №1" />
            </div>
            </div>
        </div>
    
        </div> 
    
        <!-- Кнопки-переключатели -->
        <div class="carousel-indicators">
        <button type="button" data-bs-target="#megafonCarousel" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#megafonCarousel" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#megafonCarousel" data-bs-slide-to="2" aria-label="Slide 3"></button>
        </div>
    </div>

    <!-- ТАРИФЫ -->
    <section class="tariff-section py-5">
      <div class="container">
        <div class="tariff-header d-flex flex-wrap align-items-center mb-4">
          <h2 class="tariff-title">
            Тарифы для твоего региона: <span id="cityTariff">{{ current_region.name }}</span>
          </h2>
        </div>
        
        <div class="tariff-filters d-flex flex-wrap gap-3 mb-4">
          <button class="filter-btn active" data-filter="all">Все тарифы</button>
          <button class="filter-btn" data-filter="internet-mobile-tv">Интернет, мобильная связь + ТВ</button>
          <button class="filter-btn" data-filter="internet-tv">Интернет + ТВ</button>
        </div>

        <div class="tariff-carousel-container">
          <div class="tariff-carousel" id="tariffCardsContainer">
            {% if tariffs %}
            {% for tariff in tariffs %}
            <div class="tariff-card-wrapper" data-tariff-type="{% if tariff.speed_mbps and tariff.minutes %}internet-mobile-tv{% elif tariff.speed_mbps %}internet-tv{% endif %}">
              <div class="tariff-card {% if tariff.is_megatariff %}megatariff{% endif %}">
                <div class="tariff-header">
                  <h3 class="tariff-name">{{ tariff.name }}</h3>
                  <div class="tariff-price-wrapper">
                    {% if tariff.old_price %}
                      <span class="tariff-price-old" style="font-size: 20px;">{{ tariff.old_price }} ₽</span>
                    {% endif %}
                      <span class="tariff-price-current" style="font-size: 24px;">{{ tariff.current_price }} ₽</span>
            </div>
                  <div class="tariff-duration">за {{ tariff.duration_days }} дней</div>
          </div>
                
                <div class="tariff-features">
                  {% if tariff.is_home_internet %}
                  <div class="feature-row">
                    <div class="feature-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M1 9l2 2c4.97-4.97 13.03-4.97 18 0l2-2C16.93 2.93 7.08 2.93 1 9zm8 8l3 3 3-3c-1.65-1.66-4.34-1.66-6 0zm-4-4l2 2c2.76-2.76 7.24-2.76 10 0l2-2C15.14 9.14 8.87 9.14 5 13z" fill="currentColor"/>
                      </svg>
                    </div>
                    <div class="feature-text">
                      Домашний интернет
                      {% if tariff.home_internet_note %}
                      <span class="feature-promo">{{ tariff.home_internet_note }}</span>
                      {% endif %}
      </div>
                  </div>
                  {% endif %}

                  {% if tariff.speed_mbps %}
                  <div class="feature-row">
                    <div class="feature-icon" data-speed-icon>
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                        <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                        <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                        <line x1="12" y1="20" x2="12" y2="20"></line>
                      </svg>
                    </div>
                    <div class="feature-text">{{ tariff.speed_mbps }} Мбит/с</div>
                  </div>
                  {% endif %}

                  {% if tariff.tv_channels %}
                  <div class="feature-row">
                    <div class="feature-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                        <path d="M11 15.07a1 1 0 1 1-1-1 1 1 0 0 1 1 1Zm7-7.82a11.29 11.29 0 0 0-16 0l.71.75a10.29 10.29 0 0 1 14.54 0ZM12.17 13l.71-.71a4.1 4.1 0 0 0-5.79 0l.71.71a3.1 3.1 0 0 1 4.37 0Zm3.25-3.25a7.68 7.68 0 0 0-10.87 0l.71.71a6.69 6.69 0 0 1 9.45 0Z"/>
                      </svg>
                    </div>
                    <div class="feature-text">{{ tariff.tv_channels }} ТВ-каналов</div>
                  </div>
                  {% endif %}

                  {% if tariff.minutes or tariff.gigabytes %}
                    <div class="feature-row">
                      <div class="feature-icon">
                          <img src="{% static 'img/sim-card-icon.svg' %}" alt="Мобильный интернет" width="24" height="24">
                    </div>
                      <div class="feature-text">Мобильный интернет</div>
                  </div>
                  {% endif %}

                  {% if tariff.minutes %}
                  <div class="feature-row">
                    <div class="feature-icon">
                          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                            <path d="M19.5 28a3.34 3.34 0 0 0 3.5-3.11V7.25A3.47 3.47 0 0 0 19.5 4h-7A3.47 3.47 0 0 0 9 7.25v17.64A3.34 3.34 0 0 0 12.5 28ZM11 24.89V7.25A1.49 1.49 0 0 1 12.5 6h7A1.49 1.49 0 0 1 21 7.25v17.64c0 .63-.79 1.11-1.5 1.11h-7c-.71 0-1.5-.47-1.5-1.11Z"/>
                            <path d="M14 12h4v2h-4zm0-3h4v2h-4zm0 6h4v2h-4z"/>
                            <circle cx="16" cy="22.5" r="1.5"/>
                          </svg>
                    </div>
                    <div class="feature-text">{{ tariff.minutes }} минут</div>
                  </div>
                  {% endif %}
                  
                    {% if tariff.gigabytes %}
                  <div class="feature-row">
                    <div class="feature-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                        <path d="M4 16.0001C4 22.6001 9.4 28.0001 16 28.0001C20.3 28.0001 24.2 25.7001 26.4 22.0001L24.7 21.0001C21.9 25.8001 15.8 27.4001 11 24.7001C6.2 22.0001 4.6 15.8001 7.3 11.0001C10 6.20009 16.2 4.60009 21 7.30009C22.5 8.20009 23.8 9.40009 24.7 11.0001L26.4 10.0001C23 4.30009 15.7 2.30009 10 5.70009C6.3 7.80009 4 11.7001 4 16.0001ZM28 17.0001H30V15.0001H28V13.0001H26V15.0001H24V17.0001H26V19.0001H28V17.0001ZM14 20.0001V19.0001H15V17.0001H14V15.0001H12V17.0001H10.4L12.1 11.6001L10.1 11.0001L8 17.8001L9 19.0001H12V20.0001H14ZM21.4 13.6001L22.6 12.0001C20.8 10.7001 18.2 10.8001 16.6 12.4001C14.8 14.2001 14.9 17.2001 16.8 18.9001C18.4 20.4001 20.8 20.6001 22.6 19.3001L23 19.0001V15.0001H20V17.0001H21V18.0001C20 18.5001 18.8 18.3001 18 17.5001C17 16.5001 17 14.9001 18 13.9001C18.9 12.9001 20.4 12.8001 21.4 13.6001Z" fill="#333333"/>
                      </svg>
                    </div>
                    <div class="feature-text">{{ tariff.gigabytes }} ГБ</div>
              </div>
                  {% endif %}
                  </div>

                  {% if tariff.additional_number_price %}
                  <div class="feature-row" style="margin-top: 4px;">
                    <div class="feature-icon">
                      <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                        <path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"></path>
                      </svg>
                    </div>
                    <div class="feature-text" style="font-size: 13px;">Доп. номера за {{ tariff.additional_number_price }} ₽</div>
                  </div>
                  {% endif %}

                  {% if tariff.megasila_count %}
                  <div class="feature-row megasila-feature" style="margin-top: 4px;">
                    <div class="feature-icon purple">
                      <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="none">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M21.668 18.7999H27.2V19.9999L18.2 29.5999H16.4L18.332 21.1999H12.8V19.9999L21.8 10.3999H23.6L21.668 18.7999Z" fill="#731982"/>
                      </svg>
                    </div>
                    <div class="feature-text" style="font-size: 13px;">{{ tariff.megasila_count }} МегаСилы на выбор</div>
                  </div>
                  {% endif %}

                <button class="connect-btn {% if tariff.is_megatariff %}connect-btn-purple{% endif %}"
                  data-tariff-id="{{ tariff.id }}" 
                  data-tariff-name="{{ tariff.name }}" 
                  data-tariff-price="{{ tariff.current_price }}"
                  onclick="showConnectModal('{{ tariff.id }}', '{{ tariff.name }}', '{{ tariff.current_price }}')">
                  Подключить
                </button>
              </div>
            </div>
            {% endfor %}
            {% else %}
              <div class="col-12 text-center py-4">Тарифы не найдены</div>
            {% endif %}
          </div>
          <button class="carousel-control prev" id="prevTariff">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M15 18l-6-6 6-6"/>
            </svg>
          </button>
          <button class="carousel-control next" id="nextTariff">
            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M9 18l6-6-6-6"/>
            </svg>
          </button>
        </div>
      </div>
    </section>

    <script>
        // Функция для фильтрации тарифов
        function filterTariffs(filter) {
            const cards = document.querySelectorAll('.tariff-card-wrapper');
        let visibleCards = 0;
        
            cards.forEach(card => {
                if (filter === 'all' || card.dataset.tariffType === filter) {
                    card.style.display = '';
                visibleCards++;
                } else {
                    card.style.display = 'none';
                }
            });
        
        // Обновляем карусель после фильтрации
        if (typeof resetCarousel === 'function') {
            resetCarousel();
        }
        }

    document.addEventListener('DOMContentLoaded', function() {
        // Обработчики кнопок фильтрации
        document.querySelectorAll('.filter-btn').forEach(btn => {
            btn.addEventListener('click', (e) => {
                e.preventDefault();
                document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
                e.target.classList.add('active');
                filterTariffs(e.target.dataset.filter);
            });
        });

        // Обработчики кнопок подключения
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('connect-btn')) {
                e.preventDefault();
                const tariffId = e.target.getAttribute('data-tariff-id');
                const tariffName = e.target.getAttribute('data-tariff-name');
                const tariffPrice = e.target.getAttribute('data-tariff-price');
                showConnectModal(tariffId, tariffName, tariffPrice);
            }
        });

        // Настройка модальных окон
        const connectModal = document.getElementById('connectModal');
        const successModal = document.getElementById('successModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        const headerConnectBtn = document.querySelector('.header-connect-btn');
        
        // Кнопка в шапке для открытия формы подключения
        if (headerConnectBtn) {
            headerConnectBtn.addEventListener('click', function(e) {
                e.preventDefault();
                showConnectModal();
            });
        }
        
        // Закрытие модальных окон
        if (closeModalBtn) {
            closeModalBtn.addEventListener('click', function() {
                connectModal.classList.add('hidden');
            });
        }
        
        if (closeSuccessBtn) {
            closeSuccessBtn.addEventListener('click', function() {
                successModal.classList.add('hidden');
            });
        }
        
        // Закрытие по клику вне модального окна
        window.addEventListener('click', function(e) {
            if (e.target === connectModal) {
                connectModal.classList.add('hidden');
            }
            if (e.target === successModal) {
                successModal.classList.add('hidden');
            }
        });

        // Функция для отображения модального окна подключения
        window.showConnectModal = function(tariffId, tariffName, tariffPrice) {
            const modal = document.getElementById('connectModal');
            const tariffIdInput = document.getElementById('connectionTariffId');
            
            if (tariffIdInput && tariffId) {
                tariffIdInput.value = tariffId;
            }
            
            // Настраиваем заголовок модального окна
            const modalTitle = document.querySelector('#connectModal h2');
            if (modalTitle) {
                if (tariffName && tariffPrice) {
                    modalTitle.textContent = `Подключение: ${tariffName} за ${tariffPrice} ₽`;
                } else {
                    modalTitle.textContent = 'Оставьте заявку на подключение';
                }
            }
            
            // Показываем модальное окно
            modal.classList.remove('hidden');
        }
    });
    </script>

    <style>
    /* Removed inline styles to ensure external CSS is applied */
    /* .tariff-carousel-container {
        position: relative;
        width: 100%;
        overflow: visible;
        padding: 0 40px;
        margin-top: 50px;
    }

    .tariff-carousel {
        display: flex;
        transition: transform 0.3s ease;
        gap: 20px;
        padding: 20px 0;
    }

    .carousel-control {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: white;
        border: 1px solid #e0e0e0;
        display: flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        z-index: 10;
        transition: all 0.3s ease;
    }

    .carousel-control:hover {
        background: #f5f5f5;
        border-color: #731982;
    }

    .carousel-control.prev {
        left: 0;
    }

    .carousel-control.next {
        right: 0;
    }

    .carousel-control svg {
        width: 20px;
        height: 20px;
        color: #731982;
    }

    @media (max-width: 768px) {
        .tariff-carousel-container {
            padding: 0 30px;
        }

        .carousel-control {
            width: 32px;
            height: 32px;
        }

        .carousel-control svg {
            width: 16px;
            height: 16px;
        }
    } */
    </style>

    <script>
    // Функция для инициализации карусели тарифов
    function initTariffCarousel() {
      const container = document.querySelector('.tariff-carousel-container');
      const carousel = document.querySelector('.tariff-carousel');
      const prevBtn = document.querySelector('.carousel-control.prev');
      const nextBtn = document.querySelector('.carousel-control.next');
      
      if (!carousel || !container) return;
      
        function checkButtons() {
            const scrollLeft = carousel.scrollLeft;
            const maxScroll = carousel.scrollWidth - carousel.clientWidth;
            
            // Показываем/скрываем кнопки в зависимости от положения прокрутки
            if (prevBtn) prevBtn.style.display = scrollLeft > 0 ? 'flex' : 'none';
            if (nextBtn) nextBtn.style.display = scrollLeft < maxScroll ? 'flex' : 'none';
        }

        // Обработчик для кнопки "Предыдущий"
      if (prevBtn) {
            prevBtn.addEventListener('click', () => {
                const cardWidth = carousel.querySelector('.tariff-card-wrapper').offsetWidth;
                carousel.scrollBy({
                    left: -cardWidth,
                    behavior: 'smooth'
                });
            });
        }

        // Обработчик для кнопки "Следующий"
      if (nextBtn) {
            nextBtn.addEventListener('click', () => {
                const cardWidth = carousel.querySelector('.tariff-card-wrapper').offsetWidth;
                carousel.scrollBy({
                    left: cardWidth,
                    behavior: 'smooth'
                });
            });
        }

        // Обработчик события прокрутки
        carousel.addEventListener('scroll', () => {
            checkButtons();
        });

        // Обработчик изменения размера окна
        window.addEventListener('resize', () => {
            checkButtons();
        });

        // Начальная проверка кнопок
        checkButtons();

        // Обработчик завершения прокрутки
        carousel.addEventListener('scrollend', () => {
            checkButtons();
        });
    }

    // Инициализация карусели при загрузке страницы
    document.addEventListener('DOMContentLoaded', () => {
        initTariffCarousel();
    });
    </script>


    <!-- 🔽 ВСТАВЬ СЮДА СЕКЦИЮ ПРОВЕРКИ АДРЕСА -->
    <section class="address-check">
        <div class="container-custom">
        <div class="address-card">
            <div class="content">
            <h2>Проверьте ваш адрес на возможность<br>подключения к МегаФон</h2>
            <p class="subtitle">А всю остальную работу сделаем мы</p>
    
            <div class="form-wrapper">
              <form class="address-form">
                <input type="text" placeholder="Город, улица, дом">
                <input type="tel" placeholder="+7 (___) ___-__-__">
                <button type="submit">Проверить</button>
              </form>
            
              <p class="note">Важно: частные дома не подключаем!</p>
            </div>
            
            </div>
    
            <img class="absolute-image" src="../static/img/puzzle.png" alt="Пазлы">
        </div>
        </div>
    </section>



    <section class="steps-section">
        <div class="container">
        <div class="steps-header">
            <h2 class="steps-title">Как подключить интернет</h2>
            <div class="steps-list">
            <div class="step-card">
                <div class="step-number">1</div>
                <h3>Оставьте заявку</h3>
                <p>Оставьте заявку на подключение на сайте или просто позвоните нам</p>
            </div>
            <div class="step-card">
                <div class="step-number">2</div>
                <h3>Проверим адрес</h3>
                <p>Проверим ваш адрес на возможность подключения</p>
            </div>
            <div class="step-card">
                <div class="step-number">3</div>
                <h3>Подберем тариф</h3>
                <p>Проконсультируем и подберем оптимальный тарифный план</p>
            </div>
            <div class="step-card">
                <div class="step-number active">4</div>
                <h3>Подключим</h3>
                <p>Произведем подключение в удобное для вас время</p>
            </div>
            </div>
        </div>
        </div>
    </section>

    <!-- Оборудование -->
    <section class="equipment-section">
        <div class="container">
            <h2>Доступное оборудование</h2>
            <p class="equipment-subtitle">Ознакомьтесь с параметрами устройств и сообщите оператору, какое оборудование хотите подключить</p>
            <div class="equipment-container">
                <div class="card">
                    <div class="image-container">
                        <img src="{% static 'img/equipment/tv-box.png' %}" alt="ТВ-приставка МегаФон">
                    </div>
                    <h3>ТВ-приставка МегаФон</h3>
                    <p>Управляйте эфиром, перематывайте, ставьте на паузу — смотрите фильмы и сериалы как удобно.</p>
                    <h4>Характеристики приставки</h4>
                    <div class="features">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                    <path d="M24.541 5.674 23.957 5h-7.915l-2.655 3H8v6.025l-5 5.593V23h3v12h28V23h3v-3.382zM35 21h-3v12H8V21H5v-.618l5-5.593V10h4.282l2.51-2.809.165-.191h6.086L35 20.382zm-13.513 5.003a1.5 1.5 0 1 1-1.5-1.5 1.5 1.5 0 0 1 1.5 1.5zm-1.493-5.532a6.954 6.954 0 0 1 4.95 2.05l-1.414 1.414a5 5 0 0 0-7.071 0l-1.414-1.413a6.952 6.952 0 0 1 4.95-2.051zm7.792-1.14-1.414 1.414a9.011 9.011 0 0 0-12.728 0L12.23 19.33a11.012 11.012 0 0 1 15.556 0z"/>
                                </svg>
                            </div>
                            <span>Работает везде, где есть интернет</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                    <path d="M8 9a1 1 0 1 1-1-1 1 1 0 0 1 1 1Zm2-1a1 1 0 1 0 1 1 1 1 0 0 0-1-1Zm8-3.1V13a2 2 0 0 1-2 2h-5.48v2H14v1H6v-1h3.48v-2H4a2 2 0 0 1-2-2V4.9a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2Zm-1 0a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1V13a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1ZM13 8a1 1 0 1 0 1 1 1 1 0 0 0-1-1Z"/>
                                </svg>
                            </div>
                            <span>Поддерживает видео UHD и HD</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                    <path d="M11 15.07a1 1 0 1 1-1-1 1 1 0 0 1 1 1Zm7-7.82a11.29 11.29 0 0 0-16 0l.71.75a10.29 10.29 0 0 1 14.54 0ZM12.17 13l.71-.71a4.1 4.1 0 0 0-5.79 0l.71.71a3.1 3.1 0 0 1 4.37 0Zm3.25-3.25a7.68 7.68 0 0 0-10.87 0l.71.71a6.69 6.69 0 0 1 9.45 0Z"/>
                                </svg>
                            </div>
                            <span>Подключается через Wi‑Fi</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                    <path d="M19.5 28a3.34 3.34 0 0 0 3.5-3.11V7.25A3.47 3.47 0 0 0 19.5 4h-7A3.47 3.47 0 0 0 9 7.25v17.64A3.34 3.34 0 0 0 12.5 28ZM11 24.89V7.25A1.49 1.49 0 0 1 12.5 6h7A1.49 1.49 0 0 1 21 7.25v17.64c0 .63-.79 1.11-1.5 1.11h-7c-.71 0-1.5-.47-1.5-1.11Z"/>
                                    <path d="M14 12h4v2h-4zm0-3h4v2h-4zm0 6h4v2h-4z"/>
                                    <circle cx="16" cy="22.5" r="1.5"/>
                                </svg>
                            </div>
                            <span>Управляется Bluetooth‑пультом</span>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="image-container">
                        <img src="{% static 'img/equipment/router1.png' %}" alt="Роутер FR1000‑1">
                    </div>
                    <h3>Роутер FR1000‑1</h3>
                    <p>Высокоскоростной Wi‑Fi‑роутер для стабильного интернета. Ловит по всему дому. Бесплатная доставка и настройка.</p>
                    <h4>Характеристики роутера</h4>
                    <div class="features">
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32" fill="white">
                                    <path d="M6.2 23C2.7 18 3.4 11.2 8 7.1s11.5-4.1 16 0 5.3 11 1.7 15.9l-1.6-1.2c1.2-1.7 1.9-3.7 1.9-5.8 0-3.6-1.9-6.9-5-8.7s-6.9-1.8-10 0-5 5.1-5 8.7c0 2.1.7 4.1 1.9 5.8L6.2 23z"/>
                                    <circle cx="16" cy="20" r="2.5"/>
                                    <path d="m22.9 11-.8-.5-7.3 8.6 2.4 1.8zM16 26c-.6 0-1 .4-1 1s.4 1 1 1 1-.4 1-1-.4-1-1-1z"/>
                                </svg>
                            </div>
                            <span>Скорость до 1 Гбит/с</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32" fill="white">
                                    <path d="M6.08 23H15v3h-4v2h10v-2h-4v-3h8.92A3.08 3.08 0 0 0 29 19.93V7.07A3.08 3.08 0 0 0 25.92 4H6.08A3.08 3.08 0 0 0 3 7.07v12.86A3.08 3.08 0 0 0 6.08 23ZM5 7.07A1.08 1.08 0 0 1 6.08 6h19.84A1.08 1.08 0 0 1 27 7.07v12.86A1.08 1.08 0 0 1 25.92 21H6.08A1.08 1.08 0 0 1 5 19.93Z"/>
                                    <circle cx="10.96" cy="13.5" r="1.5"/>
                                    <circle cx="15.96" cy="13.5" r="1.5"/>
                                    <circle cx="20.96" cy="13.5" r="1.5"/>
                                </svg>
                            </div>
                            <span>Двухдиапазонный Wi-Fi</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon text-icon">
                                4G
                            </div>
                            <span>Возможность подключения 4G</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="white">
                                    <path d="M20 2C10.06 2 2 10.06 2 20s8.06 18 18 18 18-8.06 18-18S29.94 2 20 2zm0 32c-7.72 0-14-6.28-14-14 0-7.72 6.28-14 14-14 7.72 0 14 6.28 14 14 0 7.72-6.28 14-14 14z"/>
                                    <path d="M20 6c-7.72 0-14 6.28-14 14h4c0-5.51 4.49-10 10-10s10 4.49 10 10h4c0-7.72-6.28-14-14-14z"/>
                                </svg>
                            </div>
                            <span>Зона покрытия более 70 м²</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="white">
                                    <path d="M8 11 6.57 9.56a19 19 0 0 1 26.87 0L32 11a17 17 0 0 0-24 0Zm7.05 7 1.41 1.41a5 5 0 0 1 7.07 0L24.95 18a7 7 0 0 0-9.9 0Zm14.14-4.2a13 13 0 0 0-18.38 0l1.41 1.41a11 11 0 0 1 15.56 0ZM34 36H6V24.49l.67-.23a40.65 40.65 0 0 1 26.65 0l.67.23Zm-2-10.08a38.56 38.56 0 0 0-24 0V34h24ZM16 30h8v-2h-8Z"/>
                                </svg>
                            </div>
                            <span>4 внешние антенны MU‑MIMO</span>
                        </div>
                        <div class="feature-item">
                            <div class="feature-icon">
                                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="white">
                                    <path d="M20 4c-8.84 0-16 7.16-16 16s7.16 16 16 16 16-7.16 16-16S28.84 4 20 4zm0 4c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 24c-4.42 0-8.36-2.06-10.89-5.28 2.89-4.89 8.24-8.22 14.89-8.22s12 3.33 14.89 8.22C36.36 29.94 32.42 32 28 32h-8z"/>
                                </svg>
                            </div>
                            <span>Родительский контроль</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    
    <section class="faq-section py-5">
        <div class="container">
        <h2 class="faq-title mb-4">Частые вопросы</h2>
        <div class="accordion custom-accordion" id="faqAccordion">
    
            <!-- Вопрос 1 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#faq1" aria-expanded="true">
                Как оставить заявку на подключение МегаФон?
                </button>
            </h2>
            <div id="faq1" class="accordion-collapse collapse show" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                Оставить заявку вы можете, позвонив по номеру телефона <strong class="purple">8 (800) 250-93-87</strong> или оставить заявку на сайте.
                </div>
            </div>
            </div>
    
            <!-- Вопрос 2 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq2">
                Как узнать свой лицевой счёт?
                </button>
            </h2>
            <div id="faq2" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                Номер телефона — это ваш лицевой счёт. С его помощью можно оплатить услуги, войти в личный кабинет и в МегаФон ТВ.
                </div>
            </div>
            </div>
    
            <!-- Вопрос 3 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq3">
                Как проверить баланс?
                </button>
            </h2>
            <div id="faq3" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                Проверить баланс можно в голосовом меню (позвонив на <strong>0500</strong>), с помощью USSD команды <code>*100#</code> или в личном кабинете.
                </div>
            </div>
            </div>
    
            <!-- Вопрос 4 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq4">
                Как пополнить счёт?
                </button>
            </h2>
            <div id="faq4" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                <ul>
                    <li>В личном кабинете банковской картой, со счёта мобильного телефона, с помощью электронного кошелька.</li>
                    <li>В приложении Сбербанк Онлайн — раздел «Платежи или переводы», раздел «Интернет и ТВ», указать МегаФон, ввести номер лицевого счёта и сумму.</li>
                    <li>В терминалах Qiwi, CyberPlat, Элекснет, банкоматах и салонах связи: МегаФон Ритейл, Связной.</li>
                </ul>
                </div>
            </div>
            </div>
    
            <!-- Вопрос 5 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq5">
                Как перейти в МегаФон со своим номером?
                </button>
            </h2>
            <div id="faq5" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                Вы можете, позвонив по номеру <strong class="purple">8 (800) 250-93-87</strong> или оставить заявку на сайте.<br><br>
                <strong>Условия переноса номера:</strong>
                <ul>
                    <li>На поданный номер оформлено либо доверенность прилагается.</li>
                    <li>Контактные данные и паспортные соответствуют текущим данным.</li>
                    <li>Нет задолженности.</li>
                    <li>Номер не заблокирован, не в розыске, не корпоративный.</li>
                    <li>С момента последнего переноса прошло более 60 дней.</li>
                </ul>
                </div>
            </div>
            </div>
    
            <!-- Вопрос 6 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq6">
                Куда мне обращаться, если возникают проблемы при пользовании услугой?
                </button>
            </h2>
            <div id="faq6" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                Обратитесь по номеру <strong class="purple">8 (800) 250-93-87</strong>. Мы будем рады вам помочь!
                </div>
            </div>
            </div>
    
            <!-- Вопрос 7 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq7">
                Какой тариф МегаФон самый выгодный?
                </button>
            </h2>
            <div id="faq7" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                На текущий момент самыми выгодными тарифами считаются МегаФон БезПереплат и МегаТариф. Подключение — по номеру <strong class="purple">8 (800) 250-93-87</strong> или на сайте.
                </div>
            </div>
            </div>
    
            <!-- Вопрос 8 -->
            <div class="accordion-item">
            <h2 class="accordion-header">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#faq8">
                Какой тариф домашнего интернета выбрать?
                </button>
            </h2>
            <div id="faq8" class="accordion-collapse collapse" data-bs-parent="#faqAccordion">
                <div class="accordion-body">
                Обратите внимание на тарифы МегаФон и его тариф БезПереплат и МегаТариф, с возможностью выбора. Подключение по номеру <strong class="purple">8 (800) 250-93-87</strong> или на сайте.
                </div>
            </div>
            </div>
    
        </div>
        </div>
    </section>
    




        <!-- Bootstrap JS -->
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>


        <script>
        // Глобальная переменная для хранения данных о регионах и городах
        let regionsAndCities = {};

        // Функция для загрузки регионов и городов с сервера
        function loadRegionsAndCities() {
            fetch('/api/regions-towns/')
            .then(response => {
                if (!response.ok) {
                throw new Error('Network response was not ok');
                }
                return response.json();
            })
            .then(data => {
                regionsAndCities = data;
                renderRegionsList();
            })
            .catch(error => {
                console.error('Error fetching regions and cities:', error);
                document.getElementById('regionsList').innerHTML = '<div class="region-placeholder">Ошибка при загрузке данных</div>';
            });
        }

        // Функция для отображения списка регионов
        function renderRegionsList() {
            const regionsList = document.getElementById('regionsList');
            
            // Сортируем регионы по алфавиту
            const sortedRegions = Object.keys(regionsAndCities).sort();
            
            let html = '';
            let currentLetter = '';
            
            sortedRegions.forEach(region => {
            // Получаем первую букву региона
            const firstLetter = region.charAt(0).toUpperCase();
            
            
            // Если это новая буква, добавляем разделитель
            if (firstLetter !== currentLetter) {
                currentLetter = firstLetter;
                html += `<div class="region-letter">${currentLetter}</div>`;
            }
            
            html += `<div class="region-item" onclick="showCities('${region}')">${region}</div>`;
            });
            
            regionsList.innerHTML = html;
        }

        // Функция для отображения городов выбранного региона  
        function showCities(region) {
            const cities = regionsAndCities[region] || [];
            const container = document.getElementById('citiesColumn');
            
            // Получаем regionId по имени региона
            fetch(`/api/regions/?name=${encodeURIComponent(region)}`)
                .then(response => response.json())
                .then(data => {
                    if (data.length > 0) {
                        const regionId = data[0].id;
                        // Получаем города с их ID
                        fetch(`/api/regions/${regionId}/towns/`)
                            .then(response => response.json())
                            .then(towns => {
                                console.log('Towns for region:', towns);
                                container.innerHTML = towns.map(town => 
                                    `<div class="city-item" 
                                        data-region-id="${regionId}" 
                                        data-town-id="${town.id}"
                                        data-region-name="${region}">
                                        ${town.name}
                                    </div>`
                                ).join('');
                            })
                            .catch(error => {
                                console.error('Error fetching towns:', error);
                                container.innerHTML = '<div class="city-placeholder">Ошибка при загрузке городов</div>';
                            });
                    }
                })
                .catch(error => {
                    console.error('Error fetching region:', error);
                    container.innerHTML = '<div class="city-placeholder">Ошибка при загрузке данных</div>';
                });
        }

        // Функция для обновления тарифов
        function updateTariffs(regionId, townId) {
            console.log('Updating tariffs for:', { regionId, townId });
            const url = `/api/tariffs/${regionId}${townId ? `?town_id=${townId}` : ''}`;
            
            fetch(url)
                .then(response => {
                    if (!response.ok) {
                        throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                })
                .then(data => {
                    console.log('Received tariffs:', data);
                    const container = document.getElementById('tariffCardsContainer');
                    
                    if (data && data.length > 0) {
                        renderTariffs(data);
                    } else {
                        container.innerHTML = '<div class="col-12 text-center py-4">Тарифы не найдены</div>';
                    }
                })
                .catch(error => {
                    console.error('Error fetching tariffs:', error);
                    const container = document.getElementById('tariffCardsContainer');
                    container.innerHTML = '<div class="col-12 text-center py-4">Ошибка при загрузке тарифов</div>';
                });
        }

        // Функция для обновления списка оборудования
        function updateEquipment(regionId) {
            const container = document.querySelector('.equipment-container');
            
            fetch(`/api/regions/${regionId}/equipment/`)
                .then(response => response.json())
                .then(data => {
                    if (data.equipment) {
                        container.innerHTML = `
                            <div class="card">
                                <div class="image-container">
                                    <img src="{% static 'img/equipment/tv-box.png' %}" alt="ТВ-приставка МегаФон">
                                </div>
                                <h3>ТВ-приставка МегаФон</h3>
                                <p>Управляйте эфиром, перематывайте, ставьте на паузу — смотрите фильмы и сериалы как удобно.</p>
                                <div class="features">
                                        <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                                <path d="M24.541 5.674 23.957 5h-7.915l-2.655 3H8v6.025l-5 5.593V23h3v12h28V23h3v-3.382zM35 21h-3v12H8V21H5v-.618l5-5.593V10h4.282l2.51-2.809.165-.191h6.086L35 20.382zm-13.513 5.003a1.5 1.5 0 1 1-1.5-1.5 1.5 1.5 0 0 1 1.5 1.5zm-1.493-5.532a6.954 6.954 0 0 1 4.95 2.05l-1.414 1.414a5 5 0 0 0-7.071 0l-1.414-1.413a6.952 6.952 0 0 1 4.95-2.051zm7.792-1.14-1.414 1.414a9.011 9.011 0 0 0-12.728 0L12.23 19.33a11.012 11.012 0 0 1 15.556 0z"/>
                                            </svg>
                                        </div>
                                        <span>Работает везде, где есть интернет</span>
                                </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                                <path d="M8 9a1 1 0 1 1-1-1 1 1 0 0 1 1 1Zm2-1a1 1 0 1 0 1 1 1 1 0 0 0-1-1Zm8-3.1V13a2 2 0 0 1-2 2h-5.48v2H14v1H6v-1h3.48v-2H4a2 2 0 0 1-2-2V4.9a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2Zm-1 0a1 1 0 0 0-1-1H4a1 1 0 0 0-1 1V13a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1ZM13 8a1 1 0 1 0 1 1 1 1 0 0 0-1-1Z"/>
                                            </svg>
                                        </div>
                                        <span>Поддерживает видео UHD и HD</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                                <path d="M11 15.07a1 1 0 1 1-1-1 1 1 0 0 1 1 1Zm7-7.82a11.29 11.29 0 0 0-16 0l.71.75a10.29 10.29 0 0 1 14.54 0ZM12.17 13l.71-.71a4.1 4.1 0 0 0-5.79 0l.71.71a3.1 3.1 0 0 1 4.37 0Zm3.25-3.25a7.68 7.68 0 0 0-10.87 0l.71.71a6.69 6.69 0 0 1 9.45 0Z"/>
                                            </svg>
                                        </div>
                                        <span>Подключается через Wi‑Fi</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32 32" class="ui-lib-icon ui-lib-icon_fill_white ui-lib-icon_size_small" aria-hidden="true" focusable="false">
                                                <path d="M19.5 28a3.34 3.34 0 0 0 3.5-3.11V7.25A3.47 3.47 0 0 0 19.5 4h-7A3.47 3.47 0 0 0 9 7.25v17.64A3.34 3.34 0 0 0 12.5 28ZM11 24.89V7.25A1.49 1.49 0 0 1 12.5 6h7A1.49 1.49 0 0 1 21 7.25v17.64c0 .63-.79 1.11-1.5 1.11h-7c-.71 0-1.5-.47-1.5-1.11Z"/>
                                                <path d="M14 12h4v2h-4zm0-3h4v2h-4zm0 6h4v2h-4z"/>
                                                <circle cx="16" cy="22.5" r="1.5"/>
                                            </svg>
                                        </div>
                                        <span>Управляется Bluetooth‑пультом</span>
                                    </div>
                                </div>
                                </div>
                                
                            <div class="card">
                                <div class="image-container">
                                    <img src="{% static 'img/equipment/router1.png' %}" alt="Роутер FR1000‑1">
                            </div>
                                <h3>Роутер FR1000‑1</h3>
                                <p>Высокоскоростной Wi‑Fi‑роутер для стабильного интернета. Ловит по всему дому. Бесплатная доставка и настройка.</p>
                                <div class="features">
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32" fill="white">
                                                <path d="M6.2 23C2.7 18 3.4 11.2 8 7.1s11.5-4.1 16 0 5.3 11 1.7 15.9l-1.6-1.2c1.2-1.7 1.9-3.7 1.9-5.8 0-3.6-1.9-6.9-5-8.7s-6.9-1.8-10 0-5 5.1-5 8.7c0 2.1.7 4.1 1.9 5.8L6.2 23z"/>
                                                <circle cx="16" cy="20" r="2.5"/>
                                                <path d="m22.9 11-.8-.5-7.3 8.6 2.4 1.8zM16 26c-.6 0-1 .4-1 1s.4 1 1 1 1-.4 1-1-.4-1-1-1z"/>
                                            </svg>
                                        </div>
                                        <span>Скорость до 1 Гбит/с</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 32 32" fill="white">
                                                <path d="M6.08 23H15v3h-4v2h10v-2h-4v-3h8.92A3.08 3.08 0 0 0 29 19.93V7.07A3.08 3.08 0 0 0 25.92 4H6.08A3.08 3.08 0 0 0 3 7.07v12.86A3.08 3.08 0 0 0 6.08 23ZM5 7.07A1.08 1.08 0 0 1 6.08 6h19.84A1.08 1.08 0 0 1 27 7.07v12.86A1.08 1.08 0 0 1 25.92 21H6.08A1.08 1.08 0 0 1 5 19.93Z"/>
                                                <circle cx="10.96" cy="13.5" r="1.5"/>
                                                <circle cx="15.96" cy="13.5" r="1.5"/>
                                                <circle cx="20.96" cy="13.5" r="1.5"/>
                                            </svg>
                                        </div>
                                        <span>Двухдиапазонный Wi-Fi</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon text-icon">
                                            4G
                                        </div>
                                        <span>Возможность подключения 4G</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="white">
                                                <path d="M20 2C10.06 2 2 10.06 2 20s8.06 18 18 18 18-8.06 18-18S29.94 2 20 2zm0 32c-7.72 0-14-6.28-14-14 0-7.72 6.28-14 14-14 7.72 0 14 6.28 14 14 0 7.72-6.28 14-14 14z"/>
                                                <path d="M20 6c-7.72 0-14 6.28-14 14h4c0-5.51 4.49-10 10-10s10 4.49 10 10h4c0-7.72-6.28-14-14-14z"/>
                                            </svg>
                                        </div>
                                        <span>Зона покрытия более 70 м²</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="white">
                                                <path d="M8 11 6.57 9.56a19 19 0 0 1 26.87 0L32 11a17 17 0 0 0-24 0Zm7.05 7 1.41 1.41a5 5 0 0 1 7.07 0L24.95 18a7 7 0 0 0-9.9 0Zm14.14-4.2a13 13 0 0 0-18.38 0l1.41 1.41a11 11 0 0 1 15.56 0ZM34 36H6V24.49l.67-.23a40.65 40.65 0 0 1 26.65 0l.67.23Zm-2-10.08a38.56 38.56 0 0 0-24 0V34h24ZM16 30h8v-2h-8Z"/>
                                            </svg>
                                        </div>
                                        <span>4 внешние антенны MU‑MIMO</span>
                                    </div>
                                    <div class="feature-item">
                                        <div class="feature-icon">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 40 40" fill="white">
                                                <path d="M20 4c-8.84 0-16 7.16-16 16s7.16 16 16 16 16-7.16 16-16S28.84 4 20 4zm0 4c2.21 0 4 1.79 4 4s-1.79 4-4 4-4-1.79-4-4 1.79-4 4-4zm0 24c-4.42 0-8.36-2.06-10.89-5.28 2.89-4.89 8.24-8.22 14.89-8.22s12 3.33 14.89 8.22C36.36 29.94 32.42 32 28 32h-8z"/>
                                            </svg>
                                        </div>
                                        <span>Родительский контроль</span>
                                    </div>
                                </div>
                            </div>`;
                    }
                })
                .catch(error => {
                    console.error('Error fetching equipment:', error);
                    container.innerHTML = '<div class="error-message">Ошибка при загрузке оборудования</div>';
                });
        }

        // Обновляем функцию updateSelectedCity
        function updateSelectedCity(city, regionId, townId) {
            console.log('Updating selected city:', { city, regionId, townId });
            
            document.getElementById('cityHeader').innerText = city;
            document.getElementById('cityTariff').innerText = city;
            
            // Сохраняем выбранный город и регион в localStorage
            localStorage.setItem('selectedCity', city);
            localStorage.setItem('selectedRegionId', regionId);
            if (townId) {
                localStorage.setItem('selectedTownId', townId);
            } else {
                localStorage.removeItem('selectedTownId');
            }
            
            // Загружаем тарифы и оборудование для выбранного города
            updateTariffs(regionId, townId);
            updateEquipment(regionId);
            
            // Закрываем модальное окно
            document.getElementById('cityModal').classList.add('hidden');
        }

        // Обработчик клика по городу
        document.addEventListener('click', function (e) {
            if (e.target.classList.contains('city-item')) {
                const selectedCity = e.target.innerText;
                const selectedRegion = e.target.dataset.regionId;
                const selectedTownId = e.target.dataset.townId;
                
                console.log('City clicked:', { 
                    city: selectedCity, 
                    regionId: selectedRegion, 
                    townId: selectedTownId 
                });

                // Снимаем выделение с других городов
                document.querySelectorAll('.city-item').forEach(el => el.classList.remove('active'));
                // Добавляем выделение текущему
                e.target.classList.add('active');

                // Обновляем информацию о выбранном городе
                updateSelectedCity(selectedCity, selectedRegion, selectedTownId);
            }
        });

        // При загрузке страницы
        window.onload = function () {
            const cityModal = document.getElementById('cityModal');
            const closeBtn = document.querySelector('.close-btn');
            const searchInput = document.getElementById("citySearch");
            const searchIcon = document.querySelector(".search-icon");

            // Загружаем регионы и города
            loadRegionsAndCities();

            // Восстанавливаем выбранный город
            const savedCity = localStorage.getItem('selectedCity');
            const savedRegionId = localStorage.getItem('selectedRegionId');
            const savedTownId = localStorage.getItem('selectedTownId');
            
            if (savedCity && savedRegionId) {
                console.log('Restoring saved city:', { 
                    city: savedCity, 
                    regionId: savedRegionId, 
                    townId: savedTownId 
                });
                updateSelectedCity(savedCity, savedRegionId, savedTownId);
            }

            // Настраиваем поиск городов
            searchInput.addEventListener("keydown", function (e) {
            if (e.key === "Enter") {
                e.preventDefault();
                filterCities();
            }
            });

            searchIcon.addEventListener("click", function (e) {
            e.preventDefault();
            filterCities();
            });

            // Закрытие модального окна
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    cityModal.classList.add('hidden');
                });
            }

            // Закрытие по клику на фон
            window.addEventListener('click', (e) => {
                if (e.target === cityModal) {
                    cityModal.classList.add('hidden');
                }
            });
        };

        function renderTariffs(tariffs) {
            console.log('Rendering tariffs:', tariffs);
            const container = document.getElementById('tariffCardsContainer');
            
            const tariffHTML = tariffs.map(tariff => `
                <div class="tariff-card-wrapper" data-tariff-type="${getTariffType(tariff)}">
                    <div class="tariff-card ${tariff.is_megatariff ? 'megatariff' : ''}">
                        <div class="tariff-header">
                            <h3 class="tariff-name">${tariff.name}</h3>
                            <div class="tariff-price-wrapper">
                                ${tariff.old_price ? `<span class="tariff-price-old">${tariff.old_price} ₽</span>` : ''}
                                <span class="tariff-price-current">${tariff.current_price} ₽</span>
                            </div>
                            <div class="tariff-duration">за ${tariff.duration_days} дней</div>
                        </div>
                        
                        <div class="tariff-features">
                            ${tariff.is_home_internet ? `
                                <div class="feature-row">
                                    <div class="feature-icon">
                                        <img src="{% static 'img/speed-icon.png' %}" alt="Скорость интернета" width="24" height="24" style="object-fit: contain;">
                                    </div>
                                    <div class="feature-text">
                                        Домашний интернет
                                        ${tariff.home_internet_note ? `<span class="feature-promo">${tariff.home_internet_note}</span>` : ''}
                                    </div>
                                </div>
                            ` : ''}

                            ${tariff.speed_mbps ? `
                                <div class="feature-row">
                                    <div class="feature-icon" data-speed-icon>
                                        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                            <path d="M5 12.55a11 11 0 0 1 14.08 0"></path>
                                            <path d="M1.42 9a16 16 0 0 1 21.16 0"></path>
                                            <path d="M8.53 16.11a6 6 0 0 1 6.95 0"></path>
                                            <line x1="12" y1="20" x2="12" y2="20"></line>
                                        </svg>
                                    </div>
                                    <div class="feature-text">${tariff.speed_mbps} Мбит/с</div>
                                </div>
                            ` : ''}

                            ${tariff.tv_channels ? `
                                <div class="feature-row">
                                    <div class="feature-icon">
                                        <svg width="24" height="24" viewBox="0 0 32 32" fill="none">
                                            <path d="M11 11.91V20.08L12.32 21L21 17.22V14.64L12.25 11L11 11.91ZM13 13.49L19 15.93L13 18.47V13.49Z" fill="currentColor"/>
                                            <path d="M24.74 7H19.59L20.89 4.39L19.11 3.5L17.36 7H14.64L12.89 3.5L11.1 4.39L12.41 7H7.26C6.39621 7.00264 5.56854 7.34695 4.95775 7.95775C4.34695 8.56854 4.00264 9.39621 4 10.26V21.74C4.00264 22.6038 4.34695 23.4315 4.95775 24.0423C5.56854 24.6531 6.39621 24.9974 7.26 25H24.75C25.1768 25 25.5994 24.9159 25.9937 24.7526C26.388 24.5893 26.7463 24.3499 27.0481 24.0481C27.3499 23.7463 27.5893 23.388 27.7526 22.9937C27.9159 22.5994 28 22.1768 28 21.75V10.26C27.9974 9.39621 27.6531 8.56854 27.0423 7.95775C26.4315 7.34695 25.6038 7.00264 24.74 7ZM26 21.75C26 22.0815 25.8683 22.3995 25.6339 22.6339C25.3995 22.8683 25.0815 23 24.75 23H7.26C6.92664 22.9974 6.60767 22.8638 6.37194 22.6281C6.1362 22.3923 6.00261 22.0734 6 21.74V10.26C6.00261 9.92664 6.1362 9.60767 6.37194 9.37193C6.60767 9.1362 6.92664 9.00261 7.26 9H24.74C25.0734 9.00261 25.3923 9.1362 25.6281 9.37193C25.8638 9.60767 25.9974 9.92664 26 10.26V21.75Z" fill="currentColor"/>
                                        </svg>
                                    </div>
                                    <div class="feature-text">${tariff.tv_channels} ТВ-каналов</div>
                                </div>
                            ` : ''}

                            ${(tariff.minutes || tariff.gigabytes) ? `
                                <div class="feature-row">
                                    <div class="feature-icon">
                                        <img src="{% static 'img/sim-card-icon.png' %}" alt="Мобильная связь" width="24" height="24">
                                    </div>
                                    <div class="feature-text">Мобильная связь</div>
                                </div>
                            ` : ''}

                            ${tariff.minutes ? `
                                <div class="feature-row">
                                    <div class="feature-icon">
                                        <svg width="16" height="16" viewBox="0 0 32 32" fill="none">
                                            <path d="M20.75 28C21.1768 28 21.5994 27.9159 21.9937 27.7526C22.388 27.5893 22.7463 27.3499 23.0481 27.0481C23.3499 26.7463 23.5893 26.388 23.7526 25.9937C23.9159 25.5994 24 25.1768 24 24.75V7.25C24 6.38805 23.6576 5.5614 23.0481 4.9519C22.4386 4.34241 21.612 4 20.75 4H11.25C10.388 4 9.5614 4.34241 8.9519 4.9519C8.34241 5.5614 8 6.38805 8 7.25V24.75C8 25.1768 8.08406 25.5994 8.24739 25.9937C8.41072 26.388 8.65011 26.7463 8.9519 27.0481C9.25369 27.3499 9.61197 27.5893 10.0063 27.7526C10.4006 27.9159 10.8232 28 11.25 28H20.75ZM10 24.75V7.25C10 6.91848 10.1317 6.60054 10.3661 6.36612C10.6005 6.1317 10.9185 6 11.25 6H20.75C21.0815 6 21.3995 6.1317 21.6339 6.36612C21.8683 6.60054 22 6.91848 22 7.25V24.75C22 25.0815 21.8683 25.3995 21.6339 25.6339C21.3995 25.8683 21.0815 26 20.75 26H11.25C10.9185 26 10.6005 25.8683 10.3661 25.6339C10.1317 25.3995 10 25.0815 10 24.75Z" fill="#333333"/>
                                            <path d="M19 7H13V9H19V7Z" fill="#333333"/>
                                            <path d="M16 25C16.8284 25 17.5 24.3284 17.5 23.5C17.5 22.6716 16.8284 22 16 22C15.1716 22 14.5 22.6716 14.5 23.5C14.5 24.3284 15.1716 25 16 25Z" fill="#333333"/>
                                        </svg>
                                    </div>
                                    <div class="feature-text">${tariff.minutes} минут</div>
                                </div>
                            ` : ''}

                            ${tariff.gigabytes ? `
                                <div class="feature-row">
                                    <div class="feature-icon">
                                        <svg width="16" height="16" viewBox="0 0 32 32" fill="none">
                                            <path d="M4 16.0001C4 22.6001 9.4 28.0001 16 28.0001C20.3 28.0001 24.2 25.7001 26.4 22.0001L24.7 21.0001C21.9 25.8001 15.8 27.4001 11 24.7001C6.2 22.0001 4.6 15.8001 7.3 11.0001C10 6.20009 16.2 4.60009 21 7.30009C22.5 8.20009 23.8 9.40009 24.7 11.0001L26.4 10.0001C23 4.30009 15.7 2.30009 10 5.70009C6.3 7.80009 4 11.7001 4 16.0001ZM28 17.0001H30V15.0001H28V13.0001H26V15.0001H24V17.0001H26V19.0001H28V17.0001ZM14 20.0001V19.0001H15V17.0001H14V15.0001H12V17.0001H10.4L12.1 11.6001L10.1 11.0001L8 17.8001L9 19.0001H12V20.0001H14ZM21.4 13.6001L22.6 12.0001C20.8 10.7001 18.2 10.8001 16.6 12.4001C14.8 14.2001 14.9 17.2001 16.8 18.9001C18.4 20.4001 20.8 20.6001 22.6 19.3001L23 19.0001V15.0001H20V17.0001H21V18.0001C20 18.5001 18.8 18.3001 18 17.5001C17 16.5001 17 14.9001 18 13.9001C18.9 12.9001 20.4 12.8001 21.4 13.6001Z" fill="#333333"/>
                                        </svg>
                                    </div>
                                    <div class="feature-text">${tariff.gigabytes} ГБ</div>
                                </div>
                            ` : ''}
                        </div>

                        <div class="tariff-footer" style="margin-top: auto; padding-top: 8px;">
                            ${tariff.additional_number_price ? `
                                <div class="feature-row" style="margin: 0 16px 8px;">
                                    <div class="feature-icon">
                                        <svg width="16" height="16" viewBox="0 0 40 40" fill="none">
                                            <path d="M16.4031 13.62C16.7174 13.9347 17.0979 14.1759 17.517 14.3261C17.9362 14.4764 18.3836 14.532 18.8269 14.489C19.2703 14.4459 19.6985 14.3053 20.0807 14.0772C20.4629 13.8491 20.7895 13.5392 21.037 13.17C21.3663 12.6751 21.5408 12.0939 21.5385 11.5C21.5385 10.7044 21.2215 9.94129 20.6572 9.37868C20.0929 8.81607 19.3275 8.5 18.5295 8.5C17.9328 8.50065 17.3497 8.67817 16.8544 9.01C16.3624 9.33868 15.9786 9.80481 15.7511 10.35C15.5232 10.8982 15.4635 11.5015 15.5795 12.0836C15.6956 12.6657 15.9822 13.2004 16.4031 13.62ZM25.9618 16.84C26.2745 17.1583 26.6767 17.3745 27.1153 17.46C27.5534 17.5427 28.0062 17.4975 28.4192 17.33C28.8276 17.1567 29.1762 16.8682 29.4222 16.5C29.6722 16.1309 29.805 15.6954 29.8034 15.25C29.8034 14.655 29.567 14.0842 29.1459 13.6625C28.7249 13.2409 28.1534 13.0026 27.5566 13C27.1099 12.9984 26.6731 13.1308 26.3029 13.38C25.9335 13.6253 25.6442 13.9729 25.4704 14.38C25.3023 14.7918 25.2571 15.2432 25.34 15.68C25.4238 16.1208 25.6408 16.5256 25.9618 16.84ZM10.1643 19.84C10.477 20.1583 10.8792 20.3745 11.3178 20.46C11.7559 20.5427 12.2087 20.4975 12.6217 20.33C13.03 20.1567 13.3787 19.8682 13.6247 19.5C13.9139 19.0672 14.0438 18.5479 13.9924 18.0304C13.9409 17.513 13.7112 17.0292 13.3424 16.6615C12.9736 16.2938 12.4884 16.0648 11.9693 16.0135C11.4503 15.9622 10.9294 16.0917 10.4953 16.38C10.126 16.6253 9.83663 16.9729 9.66281 17.38C9.49478 17.7918 9.4495 18.2432 9.53242 18.68C9.6214 19.1212 9.8416 19.5254 10.1643 19.84ZM22.4713 17.37C20.569 16.4268 18.4546 15.9893 16.3329 16.1H15.8815C15.8188 16.1022 15.7577 16.1197 15.7034 16.1511C15.6492 16.1825 15.6036 16.2268 15.5706 16.28C15.5407 16.3371 15.5251 16.4006 15.5251 16.465C15.5251 16.5294 15.5407 16.5929 15.5706 16.65C15.7574 17.2146 15.8523 17.8054 15.8514 18.4C15.8273 19.1418 15.7093 19.8776 15.5004 20.59C15.4558 20.699 15.4558 20.821 15.5004 20.93C15.5315 20.9774 15.5729 21.0173 15.6215 21.0467C15.6701 21.0761 15.7246 21.0943 15.7812 21.1C16.2145 21.2075 16.6078 21.4366 16.9146 21.76C17.2761 22.2975 17.4261 22.9491 17.3359 23.59C17.1754 25.41 16.8244 28.96 16.8244 28.96L17.3359 29.5H21.0972L22.8425 18.12C22.8619 17.9686 22.8338 17.8149 22.7622 17.68C22.7049 17.5458 22.6019 17.436 22.4713 17.37ZM15.2195 22.65C13.0031 21.7746 10.5352 21.7746 8.31877 22.65C8.20439 22.7058 8.11498 22.802 8.06801 22.92C8.00805 23.0371 7.98697 23.1702 8.00783 23.3L8.64976 31.5H14.8183L15.5104 23.34C15.5289 23.2111 15.5116 23.0797 15.4602 22.96C15.4185 22.8319 15.3334 22.7223 15.2195 22.65ZM30.676 20.17C30.6658 20.0777 30.635 19.9888 30.5857 19.91C30.543 19.8354 30.4849 19.7707 30.4152 19.72C29.5395 19.2508 28.5608 19.0053 27.5667 19.0053C26.5725 19.0053 25.5938 19.2508 24.7181 19.72C24.6401 19.7713 24.5749 19.8397 24.5275 19.92C24.4783 19.9988 24.4474 20.0877 24.4373 20.18L23.1534 30.8L23.7452 31.46H31.4082L32 30.79L30.676 20.17Z" fill="#333333"/>
                                        </svg>
                                    </div>
                                    <div class="feature-text">Доп. номера за ${tariff.additional_number_price} ₽</div>
                                </div>
                            ` : ''}
                            
                            ${tariff.megasila_count ? `
                                <div class="feature-row megasila-feature" style="margin: 0 16px 8px;">
                                    <div class="feature-icon purple">
                                        <svg width="30" height="30" viewBox="0 0 40 40" fill="none">
                                            <path fill-rule="evenodd" clip-rule="evenodd" d="M21.668 18.7999H27.2V19.9999L18.2 29.5999H16.4L18.332 21.1999H12.8V19.9999L21.8 10.3999H23.6L21.668 18.7999Z" fill="#731982"/>
                                        </svg>
                                    </div>
                                    <div class="feature-text" style="font-size: 13px;">${tariff.megasila_count} МегаСилы на выбор</div>
                                </div>
                            ` : ''}

                            <button class="connect-btn ${tariff.is_megatariff ? 'connect-btn-purple' : ''}"
                                data-tariff-id="${tariff.id}" 
                                data-tariff-name="${tariff.name}" 
                                data-tariff-price="${tariff.current_price}">
                                Подключить
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
            
            container.innerHTML = tariffHTML;
        }

        function getTariffType(tariff) {
            if (tariff.speed_mbps && tariff.minutes) {
                return 'internet-mobile-tv';
            } else if (tariff.speed_mbps) {
                return 'internet-tv';
            }
            return '';
        }
        </script>

        <footer class="footer">
        <div class="container-footer">
            <div class="footer-col">
            <img src="../static/img/logo.svg" alt="МегаФон" class="footer-logo" />
            <div class="footer-partner">официальный партнёр</div>
            <p class="footer-description">
                Мегафон: самые популярные тарифы и предложения: домашний интернет, телевидение, пакеты с мобильной связью, а также подключение услуг для бизнеса.
            </p>
            <small class="footer-copy">Сайт официального партнёра ПАО «МегаФон». Политика конфиденциальности</small>
            </div>

            <div class="footer-col">
            <h4>Тарифы на услуги Мегафон</h4>
            <ul>
                <li><a href="#">Мегафон домашний интернет</a></li>
                <li><a href="#">Интернет и телевидение</a></li>
                <li><a href="#">Интернет, мобильная связь и ТВ</a></li>
                <li><a href="#">Интернет и мобильная связь</a></li>
            </ul>
            </div>

            <div class="footer-col">
            <h4>Полезная информация</h4>
            <ul>
                <li><a href="#">Интернет для бизнеса</a></li>
                <li><a href="#">Контакты</a></li>
            </ul>
            </div>
            
            <div class="footer-col">
            <h4>Отдел подключения</h4>
            <div class="footer-button">
                <button class="call-btn">Позвонить</button>
            </div>
            </div>
            
        </div>
        </footer>

      <!-- Модальное окно подключения -->
      <div id="connectModal" class="modal hidden">
        <div class="modal-content">
          <span class="modal-close" id="closeModalBtn">&times;</span>
          <h2>Оставьте заявку на подключение</h2>
          <form id="connectionForm" novalidate>
            <input type="text" id="connectionName" name="name" placeholder="Имя" required>
            <input type="tel" id="connectionPhone" name="phone" placeholder="+7 (___) ___-__-__" required>
            <input type="text" id="connectionAddress" name="address" placeholder="Адрес (необязательно)">
            <input type="hidden" id="connectionTariffId" name="tariff_id">
            <button type="submit">Оставить заявку</button>
            <p class="note">Важно: частные дома и дачи не подключаем!</p>
          </form>
        </div>
      </div>

      <!-- Модальное окно успешной заявки -->
      <div id="successModal" class="modal hidden">
        <div class="modal-content success-content">
          <h2>Заявка создана</h2>
          <p>Наш специалист свяжется с вами в ближайшее время</p>
          <button id="closeSuccessBtn" class="success-btn">Закрыть</button>
        </div>
      </div>

      <!-- Стили для модальных окон -->
      <style>
        .modal {
          position: fixed;
          top: 0;
          left: 0;
          width: 100%;
          height: 100%;
          background-color: rgba(0, 0, 0, 0.5);
          display: flex;
          align-items: center;
          justify-content: center;
          z-index: 1050;
          visibility: visible;
          opacity: 1;
        }

        .modal.hidden {
          display: none;
          visibility: hidden;
          opacity: 0;
        }

        .modal-content {
          background-color: #fff;
          padding: 30px;
          border-radius: 16px;
          width: 90%;
          max-width: 500px;
          position: relative;
          box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-close {
          position: absolute;
          top: 15px;
          right: 20px;
          font-size: 24px;
          cursor: pointer;
          color: #999;
        }

        .modal-content h2 {
          margin-top: 0;
          margin-bottom: 20px;
          font-size: 22px;
          color: #333;
        }

        .modal-content form {
          display: flex;
          flex-direction: column;
        }

        .modal-content input,
        .modal-content select {
          margin-bottom: 15px;
          padding: 12px 15px;
          border: 1px solid #ddd;
          border-radius: 8px;
          font-size: 16px;
        }

        .modal-content button {
          background-color: #00b956;
          color: white;
          border: none;
          border-radius: 30px;
          padding: 12px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          margin-top: 10px;
        }

        .modal-content button:hover {
          background-color: #009a48;
        }

        .note {
          margin-top: 15px;
          font-size: 14px;
          color: #888;
          text-align: center;
        }

        .success-content {
          text-align: center;
          padding: 40px 30px;
        }

        .success-content h2 {
          color: #00b956;
          margin-bottom: 15px;
        }

        .success-content p {
          margin-bottom: 25px;
          font-size: 16px;
          color: #555;
        }

        .success-btn {
          background-color: #00b956;
          color: white;
          border: none;
          border-radius: 30px;
          padding: 12px 30px;
          font-size: 16px;
          font-weight: 600;
          cursor: pointer;
          display: inline-block;
        }

        .hidden {
          display: none !important;
        }

        /* Стили для валидации */
        .invalid-feedback {
          color: #dc3545;
          font-size: 14px;
          margin-top: -10px;
          margin-bottom: 10px;
        }

        input.is-invalid {
          border-color: #dc3545;
        }
      </style>

      <!-- JavaScript для обработки форм -->
      <script>

        // 1. Добавим функцию загрузки тарифов
      function loadTariffs() {
        const container = document.getElementById('tariffCardsContainer');
        
        // Пример данных о тарифах (в реальности должны загружаться с сервера)
        const sampleTariffs = [
          {
            id: 1,
            name: "МегаФон 3.0 МегаТариф",
            current_price: 950,
            old_price: 1050,
            duration_days: 30,
            is_home_internet: true,
            home_internet_note: "1 месяц акция",
            speed_mbps: 500,
            tv_channels: 250,
            minutes: 1000,
            gigabytes: 35,
            megasila_count: 4
          },
          {
            id: 2,
            name: "Интернет + ТВ",
            current_price: 650,
            old_price: 800,
            duration_days: 30,
            is_home_internet: true,
            speed_mbps: 200,
            tv_channels: 160,
            minutes: 0,
            gigabytes: 0,
            megasila_count: 1
          },
          {
            id: 3,
            name: "МегаТариф Максимум",
            current_price: 850,
            old_price: 1100,
            duration_days: 30,
            is_home_internet: true,
            speed_mbps: 300,
            tv_channels: 230,
            minutes: 1200,
            gigabytes: 50,
            megasila_count: 2
          },
          {
            id: 4,
            name: "Гигабитный Экспресс",
            current_price: 780,
            old_price: 1000,
            duration_days: 30,
            is_home_internet: true,
            speed_mbps: 1000,
            tv_channels: 0,
            minutes: 0,
            gigabytes: 0,
            megasila_count: 0
          }
        ];

        // Имитация загрузки с сервера
        setTimeout(() => {
          renderTariffs(sampleTariffs);
        }, 500);
      }

      // 2. Стилизация и функциональность фильтров тарифов
      document.addEventListener('DOMContentLoaded', function() {
        // Добавляем стили для активных/неактивных кнопок фильтров
        const filterButtons = document.querySelectorAll('.filter-btn');
        filterButtons.forEach(button => {
          button.addEventListener('click', function() {
            // Удаляем класс active у всех кнопок
            filterButtons.forEach(btn => btn.classList.remove('active'));
            // Добавляем класс active нажатой кнопке
            this.classList.add('active');
            
            // Получаем значение фильтра
            const filter = this.getAttribute('data-filter');
            
            // Фильтруем тарифы
            filterTariffs(filter);
          });
        });
      });

      // Функция фильтрации тарифов
      function filterTariffs(filterType) {
        const cards = document.querySelectorAll('[data-tariff-type]');
        let visibleCards = 0;
        
        cards.forEach(card => {
          if (filterType === 'all' || card.getAttribute('data-tariff-type') === filterType) {
            card.style.display = 'block';
            visibleCards++;
          } else {
            card.style.display = 'none';
          }
        });

        // Сбрасываем позицию карусели после фильтрации
        resetCarousel();
      }

      // Функция для сброса позиции карусели
      function resetCarousel() {
        const container = document.querySelector('.tariff-carousel-container');
        const carousel = document.querySelector('.tariff-carousel');
        
        if (!container || !carousel) return;
        
        // Сбрасываем позицию карусели
        carousel.scrollTo({ left: 0, behavior: 'smooth' });
        
        // Обновляем кнопки
        const updateButtons = () => {
            const prevBtn = document.querySelector('.carousel-control.prev');
            const nextBtn = document.querySelector('.carousel-control.next');
          if (!prevBtn || !nextBtn) return;
          
            const maxScroll = carousel.scrollWidth - container.clientWidth;
            prevBtn.style.display = 'none';
            nextBtn.style.display = maxScroll > 0 ? 'flex' : 'none';
        };
        
        updateButtons();
      }

      // Функция для отображения модального окна подключения
      function showConnectModal(tariffId, tariffName, tariffPrice) {
        const modal = document.getElementById('connectModal');
        document.getElementById('connectionTariffId').value = tariffId;
        
        // Настраиваем заголовок модального окна
        if (tariffName && tariffPrice) {
          document.querySelector('#connectModal h2').textContent = 
            `Подключение: ${tariffName} за ${tariffPrice} ₽`;
        } else {
          document.querySelector('#connectModal h2').textContent = 'Оставьте заявку на подключение';
        }
        
        // Удаляем класс hidden и показываем модальное окно
        modal.classList.remove('hidden');
        modal.style.display = 'flex';
      }

      // Функция для обработки формы подключения
      function setupConnectionForm() {
        const form = document.getElementById('connectionForm');
        
        if (form) {
          form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            // Простая валидация
            const phoneInput = document.getElementById('connectionPhone');
            const nameInput = document.getElementById('connectionName');
            const tariffId = document.getElementById('connectionTariffId').value;
            const address = document.getElementById('connectionAddress').value;
            
            // Удаляем предыдущие сообщения об ошибках
            document.querySelectorAll('.invalid-feedback').forEach(el => el.remove());
            document.querySelectorAll('.is-invalid').forEach(el => el.classList.remove('is-invalid'));
            
            let isValid = true;
            
            // Проверка имени
            if (!nameInput.value.trim()) {
              showValidationError(nameInput, 'Пожалуйста, введите ваше имя');
              isValid = false;
            }
            
            // Проверка телефона (простая проверка)
            const phonePattern = /^\+?[0-9]{10,15}$/;
            const phoneValue = phoneInput.value.replace(/[^\d+]/g, '');
            
            if (!phoneValue || !phonePattern.test(phoneValue)) {
              showValidationError(phoneInput, 'Введите корректный номер телефона');
              isValid = false;
            }
            
            if (isValid) {
              // Отправка данных на сервер
              const formData = {
                name: nameInput.value.trim(),
                phone_number: phoneValue,
                address: address.trim() || null,
                tariff: tariffId || null
              };
              
              // Здесь будет AJAX-запрос к API
              fetch('/api/connection-requests/', {
                method: 'POST',
                headers: {
                  'Content-Type': 'application/json',
                  'X-CSRFToken': getCsrfToken() // Функция для получения CSRF-токена из cookies
                },
                body: JSON.stringify(formData)
              })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Ошибка при отправке заявки');
                }
                return response.json();
              })
              .then(data => {
                // Закрываем модальное окно подключения
                document.getElementById('connectModal').classList.add('hidden');
                
                // Очищаем форму
                form.reset();
                
                // Показываем окно успеха
                document.getElementById('successModal').classList.remove('hidden');
              })
              .catch(error => {
                console.error('Ошибка:', error);
                alert('Произошла ошибка при отправке заявки. Пожалуйста, попробуйте еще раз.');
              });
            }
          });
        }
      }

      // Функция для отображения ошибок валидации
      function showValidationError(inputElement, message) {
        inputElement.classList.add('is-invalid');
        const errorDiv = document.createElement('div');
        errorDiv.className = 'invalid-feedback';
        errorDiv.textContent = message;
        inputElement.parentNode.insertBefore(errorDiv, inputElement.nextSibling);
      }

      // Функция для получения CSRF-токена из cookies
      function getCsrfToken() {
        const name = 'csrftoken';
        const value = `; ${document.cookie}`;
        const parts = value.split(`; ${name}=`);
        if (parts.length === 2) return parts.pop().split(';').shift();
        return '';
      }

      // Настройка формы проверки адреса
      function setupAddressCheckForm() {
        const addressForm = document.querySelector('.address-form');
        
        if (addressForm) {
          addressForm.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const inputs = addressForm.querySelectorAll('input');
            const address = inputs[0].value.trim();
            const phone = inputs[1].value.replace(/[^\d+]/g, '');
            
            if (!address || !phone) {
              alert('Пожалуйста, заполните все обязательные поля');
              return;
            }
            
            // Отправка данных на сервер
            const formData = {
              phone_number: phone,
              address: address
            };
            
            fetch('/api/address-check/', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCsrfToken()
              },
              body: JSON.stringify(formData)
            })
            .then(response => {
              if (!response.ok) {
                throw new Error('Ошибка при проверке адреса');
              }
              return response.json();
            })
            .then(data => {
              // Очищаем форму
              addressForm.reset();
              
              // Показываем окно успеха
              document.getElementById('successModal').classList.remove('hidden');
            })
            .catch(error => {
              console.error('Ошибка:', error);
              alert('Произошла ошибка при проверке адреса. Пожалуйста, попробуйте еще раз.');
            });
          });
        }
      }

      // Инициализация всех форм и обработчиков
      document.addEventListener('DOMContentLoaded', function() {
        // Настройка модальных окон
        const connectModal = document.getElementById('connectModal');
        const successModal = document.getElementById('successModal');
        const closeModalBtn = document.getElementById('closeModalBtn');
        const closeSuccessBtn = document.getElementById('closeSuccessBtn');
        const headerConnectBtn = document.querySelector('.header-connect-btn');
        
        // Кнопка в шапке для открытия формы подключения
        if (headerConnectBtn) {
          headerConnectBtn.addEventListener('click', function(e) {
            e.preventDefault();
            showConnectModal();
          });
        }
        
        // Закрытие модальных окон
        if (closeModalBtn) {
          closeModalBtn.addEventListener('click', function() {
            connectModal.classList.add('hidden');
          });
        }
        
        if (closeSuccessBtn) {
          closeSuccessBtn.addEventListener('click', function() {
            successModal.classList.add('hidden');
          });
        }
        
        // Закрытие по клику вне модального окна
        window.addEventListener('click', function(e) {
          if (e.target === connectModal) {
            connectModal.classList.add('hidden');
          }
          if (e.target === successModal) {
            successModal.classList.add('hidden');
          }
        });
        
        // Инициализация форм
        setupConnectionForm();
        setupAddressCheckForm();
        
        // Маска для телефона (простая версия)
        const phoneInputs = document.querySelectorAll('input[type="tel"]');
        phoneInputs.forEach(input => {
          input.addEventListener('input', function(e) {
            let value = this.value.replace(/\D/g, '');
            if (value.length > 0 && value[0] !== '7') {
              value = '7' + value;
            }
            let formattedValue = '';
            
            if (value.length > 0) {
              formattedValue = '+' + value.substring(0, 1);
            }
            if (value.length > 1) {
              formattedValue += ' (' + value.substring(1, 4);
            }
            if (value.length > 4) {
              formattedValue += ') ' + value.substring(4, 7);
            }
            if (value.length > 7) {
              formattedValue += '-' + value.substring(7, 9);
            }
            if (value.length > 9) {
              formattedValue += '-' + value.substring(9, 11);
            }
            
            this.value = formattedValue;
          });
        });
      });
      </script>

      <script>
        const burger = document.getElementById('burger-toggle');
        const menu = document.getElementById('mobileMenu');

        burger.addEventListener('click', () => {
          menu.classList.toggle('active');
        });
      </script>

      <script>
      document.addEventListener('DOMContentLoaded', function() {
          const container = document.querySelector('.tariff-carousel-container');
          const carousel = document.querySelector('.tariff-carousel');
          const prevBtn = document.querySelector('.carousel-control.prev');
          const nextBtn = document.querySelector('.carousel-control.next');
          
          if (!container || !carousel) return;
          
          let startX = 0;
          let currentX = 0;
          let isDragging = false;
          const cardWidth = window.innerWidth <= 768 ? 260 : 280;
          const gap = 20;
          
          // Handle touch events for mobile
          carousel.addEventListener('touchstart', (e) => {
              startX = e.touches[0].clientX;
              isDragging = true;
              e.preventDefault();
          }, { passive: false });
          
          carousel.addEventListener('touchmove', (e) => {
              if (!isDragging) return;
              currentX = e.touches[0].clientX;
              const diff = startX - currentX;
              container.scrollLeft += diff;
              startX = currentX;
          }, { passive: false });
          
          carousel.addEventListener('touchend', () => {
              isDragging = false;
          });
          
          // Handle button clicks for desktop
          if (prevBtn) {
              prevBtn.addEventListener('click', () => {
                  container.scrollLeft -= cardWidth + gap;
              });
          }
          
          if (nextBtn) {
              nextBtn.addEventListener('click', () => {
                  container.scrollLeft += cardWidth + gap;
              });
          }
          
          // Hide navigation buttons on mobile
          function updateButtonVisibility() {
              const isMobile = window.innerWidth <= 768;
              if (prevBtn) prevBtn.style.display = isMobile ? 'none' : 'block';
              if (nextBtn) nextBtn.style.display = isMobile ? 'none' : 'block';
          }
          
          window.addEventListener('resize', updateButtonVisibility);
          updateButtonVisibility();
      });
      </script>

    </body>
    </html>

{% endblock %}



